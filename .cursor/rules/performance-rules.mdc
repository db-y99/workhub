---
alwaysApply: true
---
## 1ï¸âƒ£ PAGE LUÃ”N LÃ€ SERVER COMPONENT

**Rule:** Táº¥t cáº£ file `page.tsx` pháº£i lÃ  Server Component (khÃ´ng cÃ³ `'use client'`)

**LÃ½ do:**
- Server Components render trÃªn server, giáº£m JavaScript bundle
- Tá»± Ä‘á»™ng code splitting
- CÃ³ thá»ƒ fetch data trá»±c tiáº¿p tá»« database

**VÃ­ dá»¥:**
```typescript
// âœ… ÄÃšNG - app/users/page.tsx
import { getUsersService } from '@/services/users/users.service';
import UsersTable from '@/components/users-table.client';

const UsersPage = async () => {
  const users = await getUsersService();

  return <UsersTable users={users} />;
};

export default UsersPage;

// âŒ SAI - KhÃ´ng Ä‘Æ°á»£c lÃ m
'use client'; // âŒ KHÃ”NG Ä‘Æ°á»£c thÃªm vÃ o page.tsx
const UsersPage = () => { ... }
```

---

## 2ï¸âƒ£ COMPONENT > 200 DÃ’NG â†’ TÃCH

**Rule:** Náº¿u component cÃ³ hÆ¡n 200 dÃ²ng code, pháº£i tÃ¡ch thÃ nh cÃ¡c component nhá» hÆ¡n

**LÃ½ do:**
- Dá»… maintain vÃ  test
- TÄƒng kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng
- Há»— trá»£ code splitting tá»‘t hÆ¡n

**CÃ¡ch tÃ¡ch:**
```typescript
// âŒ SAI - Component quÃ¡ dÃ i (> 200 dÃ²ng)
const UserDashboard = () => {
  // 300+ dÃ²ng code...
  return <div>...</div>;
};

// âœ… ÄÃšNG - TÃ¡ch thÃ nh cÃ¡c component nhá»
// components/user-dashboard.tsx
import UserHeader from './user-header.client';
import UserStats from './user-stats.client';
import UserTable from './user-table.client';

const UserDashboard = () => {
  return (
    <div>
      <UserHeader />
      <UserStats />
      <UserTable />
    </div>
  );
};
```

---

## 3ï¸âƒ£ DYNAMIC IMPORTS & SSR RULES

**âš ï¸ IMPORTANT:** This project uses Vercel React Best Practices for detailed dynamic import patterns.

**Reference:** See `.cursor/skills/vercel-react-best-practices/rules/bundle-dynamic-imports.md` for comprehensive dynamic import guidance.

**Project-Specific Rules:**

### Dynamic Import Usage:
- âœ… **Always use `dynamic()`** for large layout components (Sidebar, Right panel, Modal)
- âœ… **Always use `dynamic()`** for heavy components (Charts, Editors, Tables)
- âœ… **Always provide loading states** with `loading` prop
- âœ… **Reference Vercel rules** for detailed examples

### SSR False Rules (CRITICAL):
**âŒ KHÃ”NG dÃ¹ng `ssr: false`** náº¿u component váº«n render tá»‘t trÃªn server
**âœ… CHá»ˆ dÃ¹ng `ssr: false`** khi component phá»¥ thuá»™c browser-only API

**LÃ½ do:**
- SSR giÃºp SEO tá»‘t hÆ¡n, initial render nhanh hÆ¡n
- Chá»‰ táº¯t SSR khi tháº­t sá»± cáº§n (browser-only API)
- TrÃ¡nh táº¯t SSR khÃ´ng cáº§n thiáº¿t â†’ máº¥t lá»£i Ã­ch cá»§a SSR

**Khi nÃ o Cáº¦N `ssr: false`:**
- âœ… Component dÃ¹ng `window`, `document`, `localStorage`, `sessionStorage`
- âœ… Chart libraries: Chart.js, Recharts, D3, etc.
- âœ… Rich text editors: TinyMCE, Quill, Draft.js, etc.
- âœ… Canvas, WebGL, Media APIs

**Khi nÃ o KHÃ”NG Cáº¦N `ssr: false`:**
- âŒ Component chá»‰ render JSX/HTML thÃ´ng thÆ°á»ng
- âŒ Sidebar, Modal, Right panel (chá»‰ render UI)
- âŒ Form components, Table components
- âŒ Component khÃ´ng dÃ¹ng browser APIs

### .client.tsx â‰  ssr: false
**Quan trá»ng:** Client Component (`.client.tsx`) váº«n cÃ³ thá»ƒ SSR Ä‘Æ°á»£c!

Client Component chá»‰ cáº§n `'use client'` directive, khÃ´ng nháº¥t thiáº¿t pháº£i táº¯t SSR. Chá»‰ táº¯t SSR khi component dÃ¹ng browser-only APIs.

**Project Convention:**
```typescript
// âœ… ÄÃšNG - Component render tá»‘t trÃªn server â†’ KHÃ”NG cáº§n ssr: false
const Sidebar = dynamic(() => import('@/components/sidebar.client'), {
  loading: () => <div>Loading sidebar...</div>,
  // KHÃ”NG cÃ³ ssr: false â†’ component váº«n SSR Ä‘Æ°á»£c!
});

// âœ… ÄÃšNG - Chart dÃ¹ng browser API â†’ Cáº¦N ssr: false
const ChartComponent = dynamic(
  () => import('@/components/chart.client'),
  {
    ssr: false, // âœ… Cáº¦N vÃ¬ Chart.js dÃ¹ng window/document
    loading: () => <div>Loading chart...</div>,
  }
);

// âŒ SAI - Táº¯t SSR khÃ´ng cáº§n thiáº¿t
const UserProfile = dynamic(() => import('@/components/user-profile.client'), {
  ssr: false, // âŒ KHÃ”NG Cáº¦N - component chá»‰ render JSX
});
```

**Project Guidelines:**
- âœ… Sidebar/Right panel â†’ `dynamic()` with **NO** `ssr: false`
- âœ… Charts/Editors â†’ `dynamic()` with `ssr: false`
- âœ… Always provide loading states
- âœ… Reference Vercel rules for detailed examples

---

## 5ï¸âƒ£ KHÃ”NG FETCH TRONG USEEFFECT CHO INITIAL LOAD

**Rule:** KhÃ´ng dÃ¹ng `useEffect` Ä‘á»ƒ fetch data cho initial load. Thay vÃ o Ä‘Ã³:
- Server Component: Fetch trá»±c tiáº¿p trong component
- Client Component: DÃ¹ng React Query hoáº·c Server Component pass data xuá»‘ng

**LÃ½ do:**
- `useEffect` cháº¡y sau khi component mount â†’ tÄƒng loading time
- Server Component fetch data trÆ°á»›c khi render â†’ nhanh hÆ¡n
- TrÃ¡nh layout shift vÃ  flash of loading state

**VÃ­ dá»¥:**
```typescript
// âŒ SAI - Fetch trong useEffect
'use client';

const UsersPage = () => {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // âŒ Fetch sau khi mount â†’ cháº­m
    fetchUsers().then(setUsers).finally(() => setLoading(false));
  }, []);

  if (loading) return <div>Loading...</div>;
  return <UsersTable users={users} />;
};

// âœ… ÄÃšNG - Server Component fetch trá»±c tiáº¿p
const UsersPage = async () => {
  const users = await getUsersService(); // Fetch trÃªn server
  return <UsersTable users={users} />;
};

// âœ… ÄÃšNG - Client Component dÃ¹ng React Query
'use client';

import { useUsersQuery } from '@/features/users/queries/use-users.query';

const UsersPage = () => {
  const { data: users, isLoading } = useUsersQuery();

  if (isLoading) return <div>Loading...</div>;
  return <UsersTable users={users} />;
};

// âœ… ÄÃšNG - React Query vá»›i initialData (No double fetch!)
const DashboardPage = async () => {
  const users = await getUsersService(); // Fetch trÃªn server
  return <UsersClient initialData={users} />;
};

// Client component vá»›i initialData
'use client';

const UsersClient = ({ initialData }: { initialData: User[] }) => {
  const { data: users } = useQuery({
    queryKey: ['users'],
    queryFn: fetchUsers,
    initialData, // âœ… No loading state, no double fetch
  });

  return <UsersTable users={users} />;
};
```

---

## 5ï¸âƒ£1ï¸âƒ£ CACHE STRATEGY CHO DATA FETCHING

**Rule:** LuÃ´n chá»n cache strategy phÃ¹ há»£p cho má»—i fetch operation. Next.js cÃ³ 3 strategies chÃ­nh:

**LÃ½ do:**
- Cache strategy áº£nh hÆ°á»Ÿng lá»›n Ä‘áº¿n performance vÃ  cost
- Static/ISR giáº£m server load vÃ  improve response time
- Dynamic chá»‰ dÃ¹ng khi cáº§n real-time data

**Cache Strategies:**

### Static (force-cache)
**DÃ¹ng cho:** Content khÃ´ng thay Ä‘á»•i thÆ°á»ng xuyÃªn
- Blog posts, documentation
- Product descriptions (Ã­t thay Ä‘á»•i)
- Static pages

```typescript
// âœ… ÄÃšNG - Static content
const blogPost = await fetch(`https://api.example.com/posts/${id}`, {
  cache: 'force-cache' // Default, cÃ³ thá»ƒ bá» qua
});
```

### ISR (Incremental Static Regeneration)
**DÃ¹ng cho:** Content thay Ä‘á»•i nhÆ°ng khÃ´ng cáº§n real-time
- Product pages (update vÃ i láº§n/ngÃ y)
- CMS content
- Dashboard vá»›i data refresh Ä‘á»‹nh ká»³

```typescript
// âœ… ÄÃšNG - ISR vá»›i revalidate
const products = await fetch('https://api.example.com/products', {
  next: { revalidate: 3600 } // Revalidate sau 1 giá»
});

// âœ… ÄÃšNG - ISR vá»›i tag-based revalidation
const cmsContent = await fetch('https://api.example.com/content', {
  next: { tags: ['cms-content'] } // CÃ³ thá»ƒ revalidate báº±ng tag
});
```

### Dynamic (no-store)
**DÃ¹ng cho:** Real-time data, user-specific data
- User dashboard vá»›i live data
- Shopping cart
- Real-time notifications

```typescript
// âœ… ÄÃšNG - Dynamic data
const userDashboard = await fetch(`https://api.example.com/dashboard/${userId}`, {
  cache: 'no-store' // KhÃ´ng cache, luÃ´n fetch fresh
});
```

**Guidelines:**
- âœ… **Æ¯u tiÃªn Static/ISR** cho content khÃ´ng cáº§n real-time
- âœ… **DÃ¹ng Dynamic** chá»‰ khi tháº­t sá»± cáº§n fresh data má»—i request
- âœ… **ISR vá»›i tags** cho CMS/dashboard Ä‘á»ƒ cÃ³ thá»ƒ revalidate khi cáº§n
- âš ï¸ **KhÃ´ng set cache strategy** â†’ Next.js sáº½ dÃ¹ng default (cÃ³ thá»ƒ khÃ´ng phÃ¹ há»£p)

**VÃ­ dá»¥ thá»±c táº¿:**
```typescript
// âœ… ÄÃšNG - Blog post (static)
async function BlogPostPage({ id }: { id: string }) {
  const post = await fetch(`https://api.example.com/posts/${id}`, {
    cache: 'force-cache' // Blog post khÃ´ng Ä‘á»•i
  });
  return <BlogPost post={post} />;
}

// âœ… ÄÃšNG - Product page (ISR)
async function ProductPage({ id }: { id: string }) {
  const product = await fetch(`https://api.example.com/products/${id}`, {
    next: { revalidate: 3600 } // Update má»—i giá»
  });
  return <Product product={product} />;
}

// âœ… ÄÃšNG - User dashboard (dynamic)
async function DashboardPage() {
  const user = await requireAuth();
  const stats = await fetch(`https://api.example.com/stats/${user.id}`, {
    cache: 'no-store' // Cáº§n fresh data
  });
  return <Dashboard stats={stats} />;
}
```

---

## 6ï¸âƒ£ TYPE NAMING CONVENTION

**Rule:** LuÃ´n dÃ¹ng `type TSomething` cho type alias (project lá»›n)

**LÃ½ do:**
- Dá»… phÃ¢n biá»‡t type vÃ  value
- Consistent naming convention
- TypeScript best practice

**VÃ­ dá»¥:**
```typescript
// âœ… ÄÃšNG - LuÃ´n dÃ¹ng type TSomething
export type TCourseItem = {
  id: string;
  title: string;
  description: string;
  price: number;
};

// âœ… ÄÃšNG - Type composition
export type TCourseWithMeta = TCourseItem & {
  createdAt: Date;
  updatedAt: Date;
};

// âœ… ÄÃšNG - Sá»­ dá»¥ng trong component
import { TCourseItem } from '@/types/course.types';

type Props = {
  course: TCourseItem;
};

const CourseCard = ({ course }: Props) => {
  return <div>{course.title}</div>;
};
```

**Quy táº¯c:**
- âœ… **LuÃ´n dÃ¹ng `type TSomething`** cho type alias
- âœ… **Interface chá»‰ dÃ¹ng khi:**
  - Cáº§n `extends` (inheritance)
  - Public contract/API definitions
- âŒ **KhÃ´ng dÃ¹ng interface** cho internal types

---

## 7ï¸âƒ£ OPTIMIZE FOR BOTH WEB AND MOBILE PERFORMANCE

**Rule:** Tá»‘i Æ°u cho cáº£ web vÃ  mobile, xem xÃ©t:
- Bundle size
- Network conditions
- Device capabilities
- Battery usage

**LÃ½ do:**
- Mobile users cÃ³ network vÃ  device limitations
- Better user experience across all devices
- SEO vÃ  Core Web Vitals

**VÃ­ dá»¥:**
```typescript
// âœ… ÄÃšNG - Responsive vÃ  optimized
'use client';

import { useMediaQuery } from '@/hooks/use-media-query';
import dynamic from 'next/dynamic';

// Chart library dÃ¹ng window/document â†’ Cáº¦N ssr: false
const HeavyChart = dynamic(() => import('@/components/heavy-chart.client'), {
  ssr: false, // âœ… Cáº¦N vÃ¬ Chart.js dÃ¹ng browser APIs
});

const Dashboard = () => {
  const isMobile = useMediaQuery('(max-width: 768px)');

  return (
    <div>
      <Header />
      {isMobile ? (
        // Lightweight mobile view
        <MobileDashboard />
      ) : (
        // Full desktop view with charts
        <>
          <DesktopDashboard />
          <HeavyChart />
        </>
      )}
    </div>
  );
};
```

---

## 4ï¸âƒ£ ASYNC OPERATIONS & PARALLELIZATION

**Reference:** See `.cursor/skills/vercel-react-best-practices/rules/async-parallel.md` for detailed Promise.all() patterns and waterfall elimination.

**Project Rule:** Always use `Promise.all()` for independent async operations.

**Example:**
```typescript
// âœ… ÄÃšNG - Parallel operations
const [user, posts, comments] = await Promise.all([
  fetchUser(),
  fetchPosts(),
  fetchComments()
]);
```

**Server Component Pattern:**
```typescript
// âœ… ÄÃšNG - Server component vá»›i parallel fetches
const DashboardPage = async () => {
  // Start all fetches immediately
  const [stats, recentPosts, userProfile] = await Promise.all([
    getDashboardStats(),
    getRecentPosts(),
    getCurrentUserProfile()
  ]);

  return <Dashboard stats={stats} posts={recentPosts} profile={userProfile} />;
};
```

---

## 8ï¸âƒ£ PREFER SUSPENSE OVER MANUAL LOADING STATES

**Rule:** Prefer Suspense boundaries over manual loading states when possible

**LÃ½ do:**
- Better UX: No layout shift, faster initial render
- Automatic loading states
- Works great with Server Components
- Streaming content progressively

**VÃ­ dá»¥:**
```typescript
// âœ… ÄÃšNG - Suspense cho async components
import { Suspense } from 'react';

// Server Component vá»›i async data
async function UserProfile({ userId }: { userId: string }) {
  const user = await fetchUser(userId); // Async fetch
  return <div>{user.name}</div>;
}

// Client wrapper vá»›i Suspense
function ProfilePage({ userId }: { userId: string }) {
  return (
    <div>
      <h1>Profile</h1>
      <Suspense fallback={<div>Loading profile...</div>}>
        <UserProfile userId={userId} />
      </Suspense>
    </div>
  );
}

// âŒ KHÃ”NG - Manual loading state (layout shift)
function BadProfilePage({ userId }: { userId: string }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchUser(userId).then(setUser).finally(() => setLoading(false));
  }, [userId]);

  return (
    <div>
      <h1>Profile</h1>
      {loading ? (
        <div>Loading profile...</div> // Layout shift!
      ) : (
        <div>{user.name}</div>
      )}
    </div>
  );
}
```

**Khi nÃ o dÃ¹ng Suspense:**
- âœ… Async Server Components
- âœ… Heavy data tables
- âœ… Charts and visualizations
- âœ… Large content blocks

**Khi nÃ o dÃ¹ng manual loading:**
- âŒ Small, fast operations
- âŒ When you want layout shift
- âŒ Complex loading states (retry, error boundaries)

---

**Rule:**
- Sá»­ dá»¥ng Next.js Image component
- Chá»n format phÃ¹ há»£p (WebP, AVIF)
- Include size data
- **`loading="lazy"` lÃ  default** - khÃ´ng cáº§n set
- **Chá»‰ set `priority={true}`** cho above-the-fold images

**LÃ½ do:**
- Giáº£m bandwidth
- Faster page load
- Better Core Web Vitals
- Better SEO

**VÃ­ dá»¥:**
```typescript
// âœ… ÄÃšNG - Basic optimized image (lazy load by default)
import Image from 'next/image';

const ProductImage = ({ src, alt }: { src: string; alt: string }) => {
  return (
    <Image
      src={src}
      alt={alt}
      width={800}
      height={600}
      quality={85}
      // loading="lazy" lÃ  default - KHÃ”NG cáº§n set
      // priority={false} lÃ  default - KHÃ”NG cáº§n set
    />
  );
};

// âœ… ÄÃšNG - Hero image - priority load (above-the-fold)
const HeroImage = ({ src, alt }: { src: string; alt: string }) => {
  return (
    <Image
      src={src}
      alt={alt}
      width={1920}
      height={1080}
      quality={90}
      priority={true} // âœ… CHá»ˆ set cho above-the-fold images
      placeholder="blur"
      blurDataURL="data:image/jpeg;base64,..." // Optional: blur placeholder
    />
  );
};

// Responsive image vá»›i sizes
const ResponsiveImage = ({ src, alt }: { src: string; alt: string }) => {
  return (
    <Image
      src={src}
      alt={alt}
      width={1200}
      height={800}
      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      quality={85}
      loading="lazy"
    />
  );
};

// Remote image vá»›i domain whitelist
// next.config.js
module.exports = {
  images: {
    domains: ['example.com', 'cdn.example.com'],
    formats: ['image/avif', 'image/webp'],
  },
};

// Usage
const RemoteImage = () => {
  return (
    <Image
      src="https://example.com/image.jpg"
      alt="Remote image"
      width={800}
      height={600}
    />
  );
};
```

**Best Practices cho Images:**
- âœ… LuÃ´n dÃ¹ng Next.js `Image` component
- âœ… Specify `width` vÃ  `height` Ä‘á»ƒ trÃ¡nh layout shift
- âœ… Use `priority={true}` cho above-the-fold images
- âœ… Use `loading="lazy"` cho below-the-fold images
- âœ… Specify `sizes` cho responsive images
- âœ… Use modern formats (WebP, AVIF)
- âœ… Optimize quality (85-90 cho photos, 100 cho graphics)

---

## 9ï¸âƒ£ FONT OPTIMIZATION

**Rule:** LuÃ´n dÃ¹ng `next/font` Ä‘á»ƒ load fonts, khÃ´ng load tá»« CDN ngoÃ i

**LÃ½ do:**
- `next/font` tá»± Ä‘á»™ng optimize vÃ  self-host fonts
- Giáº£m layout shift (CLS)
- Privacy: khÃ´ng gá»­i request Ä‘áº¿n Google Fonts
- Performance: fonts Ä‘Æ°á»£c bundle vÃ  optimize

**VÃ­ dá»¥:**
```typescript
// âœ… ÄÃšNG - DÃ¹ng next/font/google
import { Inter } from 'next/font/google';

const inter = Inter({
  subsets: ['latin'],
  display: 'swap', // Giáº£m layout shift
});

export default function RootLayout({ children }) {
  return (
    <html lang="en" className={inter.className}>
      <body>{children}</body>
    </html>
  );
}

// âœ… ÄÃšNG - Custom font vá»›i next/font/local
import localFont from 'next/font/local';

const customFont = localFont({
  src: './fonts/custom-font.woff2',
  display: 'swap',
});

// âŒ SAI - Load font tá»« CDN
// âŒ KHÃ”NG Ä‘Æ°á»£c lÃ m:
<link href="https://fonts.googleapis.com/css2?family=Inter" rel="stylesheet" />

// âŒ KHÃ”NG Ä‘Æ°á»£c lÃ m:
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter');
</style>
```

**Rule:**
- âœ… **Báº®T BUá»˜C dÃ¹ng `next/font`** cho táº¥t cáº£ fonts
- âœ… **Google Fonts:** DÃ¹ng `next/font/google`
- âœ… **Custom fonts:** DÃ¹ng `next/font/local`
- âŒ **KHÃ”NG load font tá»« CDN** (`<link>`, `@import`)
- âœ… **Set `display: 'swap'`** Ä‘á»ƒ giáº£m layout shift

---

## ğŸ”Ÿ CACHE & REVALIDATION

**Rule:** DÃ¹ng `revalidateTag()` vÃ  `revalidatePath()` Ä‘á»ƒ invalidate cache khi cáº§n

**LÃ½ do:**
- ISR cache cáº§n Ä‘Æ°á»£c invalidate khi content thay Ä‘á»•i
- Tag-based revalidation linh hoáº¡t hÆ¡n path-based
- Quan trá»ng cho CMS, dashboard, admin panels

**revalidateTag() - Tag-based Revalidation**

**DÃ¹ng cho:** Content cÃ³ thá»ƒ group theo category/tag
- CMS content (blog posts, pages)
- Product categories
- Content cÃ³ thá»ƒ update theo nhÃ³m

```typescript
// âœ… ÄÃšNG - Fetch vá»›i tag
async function BlogPostPage({ id }: { id: string }) {
  const post = await fetch(`https://api.example.com/posts/${id}`, {
    next: { tags: ['blog-posts', `post-${id}`] } // Multiple tags
  });
  return <BlogPost post={post} />;
}

// âœ… ÄÃšNG - Revalidate báº±ng tag (trong Server Action)
'use server';

import { revalidateTag } from 'next/cache';

export async function updatePostAction(id: string, data: PostData) {
  await updatePostService(id, data);
  
  // Revalidate specific post
  revalidateTag(`post-${id}`);
  
  // Hoáº·c revalidate all blog posts
  revalidateTag('blog-posts');
  
  return { success: true };
}
```

**revalidatePath() - Path-based Revalidation**

**DÃ¹ng cho:** Specific pages hoáº·c route groups
- User profile pages
- Dashboard routes
- Specific page cáº§n refresh

```typescript
// âœ… ÄÃšNG - Revalidate specific path
'use server';

import { revalidatePath } from 'next/cache';

export async function updateUserAction(userId: string, data: UserData) {
  await updateUserService(userId, data);
  
  // Revalidate user profile page
  revalidatePath(`/users/${userId}`);
  
  // Hoáº·c revalidate all user pages
  revalidatePath('/users');
  
  return { success: true };
}
```

**Khi nÃ o dÃ¹ng cÃ¡i nÃ o:**
- âœ… **revalidateTag():** Khi content cÃ³ thá»ƒ group (CMS, products, blog)
- âœ… **revalidatePath():** Khi cáº§n refresh specific page hoáº·c route group
- âœ… **CÃ³ thá»ƒ dÃ¹ng cáº£ hai:** Tag cho content, path cho page structure

**VÃ­ dá»¥ thá»±c táº¿:**
```typescript
// CMS Content vá»›i tags
const cmsPage = await fetch(`https://api.example.com/pages/${slug}`, {
  next: { tags: ['cms-pages', `page-${slug}`] }
});

// Server Action update CMS
'use server';
export async function updateCMSPageAction(slug: string, content: string) {
  await updateCMSPageService(slug, content);
  revalidateTag(`page-${slug}`); // Invalidate specific page
  revalidatePath(`/pages/${slug}`); // Invalidate page route
  return { success: true };
}
```

**Guidelines:**
- âœ… **DÃ¹ng tags** cho CMS/dashboard content
- âœ… **DÃ¹ng paths** cho user-specific pages
- âœ… **Combine cáº£ hai** náº¿u cáº§n
- âš ï¸ **KhÃ´ng overuse:** Chá»‰ revalidate khi content tháº­t sá»± thay Ä‘á»•i

---

## 1ï¸âƒ£1ï¸âƒ£ ANTI-PATTERNS (Cáº¦N TRÃNH)

**Rule:** TrÃ¡nh cÃ¡c patterns phá»• biáº¿n gÃ¢y performance issues vÃ  bad UX

### âŒ "use client" toÃ n app
```typescript
// âŒ SAI - Root layout cÃ³ 'use client'
'use client'; // âŒ KHÃ”NG Ä‘Æ°á»£c lÃ m
export default function RootLayout({ children }) {
  return <html><body>{children}</body></html>;
}

// âœ… ÄÃšNG - Root layout lÃ  Server Component
export default function RootLayout({ children }) {
  return <html><body>{children}</body></html>;
}
```

### âŒ Fetch trong useEffect cho page chÃ­nh
```typescript
// âŒ SAI - Fetch trong useEffect
'use client';
const UsersPage = () => {
  const [users, setUsers] = useState([]);
  useEffect(() => {
    fetch('/api/users').then(r => r.json()).then(setUsers);
  }, []);
  return <UsersTable users={users} />;
};

// âœ… ÄÃšNG - Fetch á»Ÿ Server Component
const UsersPage = async () => {
  const users = await getUsersService();
  return <UsersTable users={users} />;
};
```

### âŒ KhÃ´ng set cache cho fetch
```typescript
// âŒ SAI - KhÃ´ng set cache strategy
const products = await fetch('https://api.example.com/products');
// Next.js sáº½ dÃ¹ng default, cÃ³ thá»ƒ khÃ´ng phÃ¹ há»£p

// âœ… ÄÃšNG - Explicit cache strategy
const products = await fetch('https://api.example.com/products', {
  next: { revalidate: 3600 } // ISR vá»›i 1 giá»
});
```

### âŒ Äáº©y toÃ n bá»™ logic sang client
```typescript
// âŒ SAI - Logic á»Ÿ client
'use client';
const Dashboard = () => {
  const [data, setData] = useState(null);
  useEffect(() => {
    // Complex logic á»Ÿ client
    fetchData().then(processData).then(setData);
  }, []);
  return <div>{/* ... */}</div>;
};

// âœ… ÄÃšNG - Logic á»Ÿ server
const Dashboard = async () => {
  const data = await getDashboardData(); // Logic á»Ÿ server
  return <DashboardClient data={data} />;
};
```

### âŒ Render table 1k+ rows á»Ÿ client
```typescript
// âŒ SAI - Render 1000 rows á»Ÿ client
'use client';
const UsersTable = ({ users }: { users: User[] }) => {
  return (
    <table>
      {users.map(user => <tr key={user.id}>...</tr>)} // 1000 rows!
    </table>
  );
};

// âœ… ÄÃšNG - Pagination hoáº·c virtualization
'use client';
import { useVirtualizer } from '@tanstack/react-virtual';

const UsersTable = ({ users }: { users: User[] }) => {
  const parentRef = useRef<HTMLDivElement>(null);
  const virtualizer = useVirtualizer({
    count: users.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 50,
  });
  
  return (
    <div ref={parentRef} style={{ height: '400px', overflow: 'auto' }}>
      {virtualizer.getVirtualItems().map(virtualRow => (
        <div key={virtualRow.key}>{/* ... */}</div>
      ))}
    </div>
  );
};
```

**Summary Anti-patterns:**
- âŒ "use client" á»Ÿ root layout hoáº·c page.tsx
- âŒ Fetch trong useEffect cho initial load
- âŒ KhÃ´ng set cache strategy cho fetch
- âŒ Äáº©y business logic sang client khÃ´ng cáº§n thiáº¿t
- âŒ Render large lists (>100 rows) khÃ´ng cÃ³ pagination/virtualization

---

## ğŸ“‹ CHECKLIST KHI VIáº¾T CODE

- [ ] Page lÃ  Server Component (khÃ´ng cÃ³ `'use client'`)?
- [ ] Component > 200 dÃ²ng Ä‘Ã£ Ä‘Æ°á»£c tÃ¡ch?
- [ ] Dynamic imports dÃ¹ng Ä‘Ãºng (reference Vercel rules)?
- [ ] SSR false chá»‰ dÃ¹ng khi component phá»¥ thuá»™c browser-only API?
- [ ] .client.tsx â‰  ssr: false (Client Component váº«n SSR Ä‘Æ°á»£c)?
- [ ] KhÃ´ng fetch trong `useEffect` cho initial load?
- [ ] React Query dÃ¹ng initialData Ä‘á»ƒ trÃ¡nh double fetch?
- [ ] Types luÃ´n dÃ¹ng `type TSomething` (khÃ´ng dÃ¹ng interface)?
- [ ] Server Component fetch data trá»±c tiáº¿p?
- [ ] Async operations dÃ¹ng `Promise.all()` khi independent?
- [ ] Suspense boundaries dÃ¹ng thay manual loading states?
- [ ] Images Ä‘Æ°á»£c optimize (format, size, lazy loading)?
- [ ] Next.js Image component Ä‘Æ°á»£c sá»­ dá»¥ng?
- [ ] loading="lazy" lÃ  default, chá»‰ set priority cho above-the-fold?
- [ ] Cache strategy Ä‘Ã£ Ä‘Æ°á»£c set cho fetch operations?
- [ ] Fonts dÃ¹ng `next/font` thay vÃ¬ CDN?
- [ ] revalidateTag/revalidatePath Ä‘Æ°á»£c dÃ¹ng khi cáº§n?
- [ ] TrÃ¡nh cÃ¡c anti-patterns (fetch trong useEffect, "use client" toÃ n app)?

---

## ğŸ¯ TÃ“M Táº®T

**Performance Best Practices (Project-Specific):**
1. **Server Components First** â†’ Giáº£m bundle size
2. **Dynamic Imports & SSR Rules** â†’ Reference Vercel, focus project conventions
3. **Async Parallelization** â†’ DÃ¹ng `Promise.all()` cho independent operations
4. **Suspense Boundaries** â†’ Prefer over manual loading states
5. **Avoid Client-side Fetch** â†’ Fetch trÃªn server + React Query initialData
6. **Component Size** â†’ TÃ¡ch component > 200 dÃ²ng
7. **Type Naming** â†’ LuÃ´n dÃ¹ng `type TSomething`
8. **Image Optimization** â†’ Next.js Image vá»›i lazy loading default
9. **Cache Strategy** â†’ Chá»n phÃ¹ há»£p (Static/ISR/Dynamic)
10. **Font Optimization** â†’ DÃ¹ng `next/font`, khÃ´ng CDN
11. **Cache Revalidation** â†’ DÃ¹ng tags/paths khi cáº§n
12. **Avoid Anti-patterns** â†’ TrÃ¡nh common mistakes

**References:**
- ğŸ”— Vercel React Best Practices: `.cursor/skills/vercel-react-best-practices/`
- ğŸ“– Dynamic Imports: `rules/bundle-dynamic-imports.md`
- âš¡ Parallel Operations: `rules/async-parallel.md`
- ğŸ¯ Suspense: `rules/async-suspense-boundaries.md`

**Má»¥c tiÃªu:**
- âš¡ Fast Initial Load
- ğŸ“¦ Small Bundle Size
- ğŸš€ Better User Experience
- ğŸ“± Great Mobile Experience
- ğŸ–¼ï¸ Optimized Images
